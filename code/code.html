<!DOCTYPE html>
<html>

<head>
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-115627522-1"></script>
    <script>
        window.dataLayer = window.dataLayer || [];

        function gtag() {
            dataLayer.push(arguments);
        }
        gtag('js', new Date());

        gtag('config', 'UA-115627522-1');
    </script>


    <title>Code</title>
    <link href="https://fonts.googleapis.com/css?family=Lato: 100,300,400,700|Luckiest+Guy|Oxygen:300,400" rel="stylesheet">

    <!-- Mobile specific meta
    --------------------------------------------------------- -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- CSS 
    --------------------------------------------------------- -->
    <link rel="stylesheet" href="../../css/normalize.css">
    <link rel="stylesheet" href="../../css/skeleton.css">
    <link rel="stylesheet" href="../../css/custom.css">
    <link href="../../css/style.css" type="text/css" rel="stylesheet">

    <!-- LaTeX
    ---------------------------------------------------------- -->
    <script src='https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-MML-AM_CHTML' async></script>
    <script type="text/x-mathjax-config">
        MathJax.Hub.Config({tex2jax: {inlineMath: [['$','$'], ['\\(','\\)']]}});
    </script>
    <script type="text/javascript" async src="https://example.com/mathjax/MathJax.js?config=TeX-AMS_CHTML">
    </script>


    <meta http-equiv="content-type" content="text/html;charset=utf-8" />


</head>

<body>
    <!-- NavBar 
    --------------------------------------------------------- -->
    <div class="navbar-spacer"></div>
    <nav class="navbar">
        <div class="container">
            <ul class="navbar-list">
                <li class="navbar-item"><a class="navbar-link" href="../index.html">Home</a></li>
                <li class="navbar-item"><a class="navbar-link" href="./code.html">Code</a></li>
                <li class="navbar-item"><a class="navbar-link" href="../resources/resources.html">Resources</a></li>
                <li class="navbar-item"><a class="navbar-link" href="../blog/blog.html">Blog</a></li>

            </ul>
        </div>
    </nav>

    <!-- First Block 
    --------------------------------------------------------- -->
    <div class="container">
        <div class="row">

            <div class="two columns">
                <a href="#r" id="linkcolor">R</a>
            </div>
            <div class="two columns">
                <a href="#c" id="linkcolor">C</a>
            </div>
            <div class="two columns">
                <a href="#shell" id="linkcolor">Shell Script</a>
            </div>
            <div class="two columns">
                <a href="#python" id="linkcolor">Python</a>
            </div>
            <div class="two columns">
                <a href="#stata" id="linkcolor">Stata</a>
            </div>
            <div class="two columns">
                <a class="button" href="https://github.com/parhamashur" target="_blank">Github</a>
            </div>
        </div>
    </div>
    <hr>
    <h5 align="center">Here I try to gather different codes that I use in my projects in one place.</h5>
    <hr>
    <div class="container">


        <h4 id="r">R</h4>
        <div class="intro_stata">
            <ul>
                <li><a href="#fisher" class="intro-item">✎ Fisher's exact test </a></li><br>
                <!---           <li><a href="#probit_logit" class="intro-item">Probit and Logit</a></li><br>
                 <li><a href="#pca" class="intro-item">Principal Component Analysis</a></li><br>
                        <li><a href="#survival_analysis" class="intro-item">Survival Analysis</a></li><br>
                        <li><a href="#monte_carlo" class="intro-item">Monte Carlo Simulation</a></li> -->
            </ul>
        </div>
        <div class="row">
            <hr>
            <div class="tweleve columns">
                <h5 id="#fisher">Fisher's exact test</h5>
                <p align="justify">In this project I wanted to conduct the Fisher's exact test for 29 variables among 4 groups (6 comparisons, 1:2, 1:3, 1:4, 2:3, 2:4, 3:4).</p>
                <pre>
                    <code>
#install.packages("rcompanion", dependencies = T)
#install.packages("TH.data")
#install.packages("mvtnorm")
library(mvtnorm)
library(TH.data)
library(rcompanion)

Data &lt- read.csv2("~path_to/data.csv", header=T)

Matrix_Test &lt- matrix(0,ncol = 29, nrow = 6)
Matrix_Test &lt- as.data.frame(Matrix_Test)
Matrix_Test[,1] &lt- Pairwise_Exact_Test$Comparison
colnames(Matrix_Test) &lt- colnames(Data)
colnames(Matrix_Test)[1] &lt- "Comparison"


for (i in 2:29){
  pairwise_table_temp &lt- table(Data[,i], Data[,1])
  Pairwise_Exact_Test_temp &lt- pairwiseNominalIndependence(pairwise_table_temp, comare="column", fisher=T, chisq = F, gtest = F, method="bonferroni")
  Matrix_Test[,i] &lt- Pairwise_Exact_Test_temp$p.adj.Fisher
}
write.csv(Matrix_Test, "~path_to/FinalResult.csv")
</code>
                </pre>
            </div>
        </div>
    </div>
    <hr>
    <div class="container">
        <h4 id="c">C for Arduino</h4>
        <div class="intro_stata">
            <ul>
                <li><a href="#auto_irrigation" class="intro-item">✎ Automatic Irrigation</a></li><br>
                <!---         <li><a href="#probit_logit" class="intro-item">Probit and Logit</a></li><br>
                   <li><a href="#pca" class="intro-item">Principal Component Analysis</a></li><br>
                        <li><a href="#survival_analysis" class="intro-item">Survival Analysis</a></li><br>
                        <li><a href="#monte_carlo" class="intro-item">Monte Carlo Simulation</a></li> -->
            </ul>
        </div>
        <div class="row">
            <hr>
            <div class="tweleve columns">
                <h5 id="#auto_irrigation">Automatic Irrigation</h5>
                <p align="justify">In this system, soil moisture sensor senses the moisture level of the soil. If soil will get dry then sensor senses low moisture level and automatically switches on the water pump to supply water to the plant. As plant get sufficient water and soil get wet then sensor senses enough moisture in soil. After which the water pump will automatically get stopped. I use the following code. </p>
                <pre>
                    <code>
int WATERPUMP = 13; //motor pump connected to pin 13
int sensor = 8; //sensor digital pin connected to pin 8
int val; //This variable stores the value received from Soil moisture sensor.

void setup() {
  
  pinMode(13,OUTPUT); //Set pin 13 as OUTPUT pin
  pinMode(8,INPUT); //Set pin 8 as input pin, to receive data from Soil moisture sensor.
  //Initialize serial and wait for port to open:
  Serial.begin(9600); // opens serial port, sets data rate to 9600 bps
  while (! Serial);// wait for serial port to connect. Needed for native USB
  Serial.println("Speed 0 to 255");
}

void loop()
  { 
  if (Serial.available()) //loop to operate motor
  {
    int speed = Serial.parseInt(); // to read the number entered as text in the Serial Monitor 
    if (speed >= 0 && speed &lt= 255)
    {
      analogWrite(WATERPUMP, speed);// tuns on the motor at specified speed 
    }
  }
  val = digitalRead(8);  //Read data from soil moisture sensor  
  if(val == LOW) 
  {
  digitalWrite(13,LOW); //if soil moisture sensor provides LOW value send LOW value to motor pump and motor pump goes off
  }
  else
  {
  digitalWrite(13,HIGH); //if soil moisture sensor provides HIGH value send HIGH value to motor pump and motor pump get on
  }
  delay(400); //Wait for few second and then continue the loop.
}
</code>
                </pre>
            </div>
        </div>
    </div>

    <hr>
    <div class="container">
        <h4 id="shell">Shell Script</h4>
        <div class="intro_stata">
            <ul>
                <li><a href="#text_cleaning" class="intro-item">✎ Text Cleaning</a></li><br>
                <li><a href="#file_name" class="intro-item">✎ File Name Manipulation</a></li><br>
                <li><a href="#file_content" class="intro-item">✎ File Content Manipulation</a></li><br>
                <!---         <li><a href="#survival_analysis" class="intro-item">Survival Analysis</a></li><br>
                        <li><a href="#monte_carlo" class="intro-item">Monte Carlo Simulation</a></li> -->
            </ul>
        </div>
        <hr>
        <div class="row">
            <div class="twelve columns">
                <h5 id="text_cleaning">Text Cleaning</h5>
                <p align="justify">
                    In a project I needed to extract part of chat transcripts to new text file. There were more than 400 files where I wanted to:1) take the age and put it as part of new file names, 2) extract only what the child says (*CHI), 3) clean all the extra characters, 4) save in a new file.</p>
                <pre>
                Chat example:
                @ID:	fra|Lyon|CHI|1;02.11|female|||Target_Child|||
                @ID:	fra|Lyon|MOT|25;01.18|female|||Mother|||
                @ID:	fra|Lyon|INV|25;01.18|female|||Investigator|||
                @Media:	10211a, video
                @Transcriber:	géraldine hilaire , christelle dodane
                @Date:	27-AUG-2002
                *CHI:	www [= ! crie] . 1945_14005
                *INV:	qu'est ce qu'i(l) y a ?
                %mor:	pro:int|que$v:aux|être&PRES&3s pro:dem|ce pro:rel
                *MOT:	non Moune t(u) as fini de manger . 15982_25097
                %mor:	co|non=no n:prop|Moune pro:subj|tu v:aux|avoir
                %sit:	CHI se dirige vers la chaise+haute .
                *CHI:	www [= ! crie] . 25100_27592
                %sit:	CHI tente de monter sur sa chaise .
                *CHI:	‹www [= ! crie] (.)› yyy . 28100_33457
                %pho:	* ba
                %mod:	* *
                *INV:	ça c'est bien passé avec Rym ?
                %mor:	pro:dem|ça pro:dem|ce$v:aux|être&PRES&3s 
                *INV:	parce que je l'ai pas revue comme elle partait juste après .
                %mor:	adv|parce pro:rel|que pro:subj|je pro:subj|il$v
                *MOT:	oui . 33457_42678
                %mor:	co|oui=yes .
                %sit:	bruits de vaisselle .
                *MOT:	oui .
                %mor:	co|oui=yes .
                *CHI:	xxx . 42678_71410
                </pre>
                <pre>
<code>
for file in *; do #Go through all files

    #in each file, search for a line that starts with @ID and has "Target"
    #keep everything before the "Target", cut everything other than age
    #in our example "1;02.11", and save it in the variable age
	age=$(cat $file | grep '@ID.*Target' | cut -c19-25)
    
    #removing all unwanted characters, changing *CHI to XYZ (for 
    #the later on programming purpose)
	txt=$(cat $file | grep -e '*' | grep -v '%' | grep -v '*CHI' | sed 's/\[.*//' | 
        cut -c5- |awk '$0="XYZ"$0' | tr -d '0123456789_!?.()+&lt&gt') 
        
    #saving the extracted text to a file containing the child name and the age.    
	echo $txt > test/ChildName-$age.txt
done
</code></pre>

            </div>
        </div>

        <hr class="hr_half">
        <div class="row">
            <div class="twelve columns">
                <h5 id="file_name">File name manipulation</h5>
                Here, I show you how to manipulate file names in different ways using shell script in terminal. These are codes that I used in my projects.
                <pre>
                    <code>
#removing that last 23 characters before .mov in all files ending in .mov
for f in *mov; do
	mv — “$f” “${f:0: -23}.mov”
done
#or writng the part you want to remove
for x in *mov; do
  mv -- "$x" "${x//-Apple ProRes 422 Proxy/}"
done


#replacing number 2 at the end of file names with _m 
for x in *"2"*; do
  mv -- "$x" "${x//2/_m}"
done

#adding a text, here "Fixation_", to the begining of file names
for i in *; do mv "$i" Fixation_"$i"; done
</code></pre>
            </div>
        </div>
        <hr class="hr_half">
        <div class="row">
            <div class="twelve columns">
                <h5 id="file_content">File content manipulation</h5>
                Here, I show you how to manipulate content of a file.
                <pre>
                    <code>
#adding @ at the end of words
#changing "prob1003  = cprob1003 * ind_1003 * 234" to "prob1003@  = cprob1003@ * ind_1003@ * 234" 
sed 's/[_A-Za-z][_0-9A-Za-z]*/&@/g' filename.txt
</code></pre>
            </div>
        </div>
    </div>

    <hr>
    <div class="container">
        <h4 id="python">Python</h4>
        <div class="intro_stata">
            <ul>
                <li><a href="#cutsound" class="intro-item">✎ Cut sound at silence</a></li><br>
                <li><a href="#rename_audio" class="intro-item">✎ Rename audio files from .txt</a></li><br>
                <li><a href="#concatenate" class="intro-item">✎ Concatenate two sound files</a></li><br>
                <!---             <li><a href="#survival_analysis" class="intro-item">Survival Analysis</a></li><br>
                        <li><a href="#monte_carlo" class="intro-item">Monte Carlo Simulation</a></li> -->
            </ul>
        </div>

        <hr>
        <div class="row">
            <div class="tweleve columns">
                <h5 id="cut_sound">Cut sound at silence</h5>
                I wanted to segment audios when there is a silence period.
                <pre>
                    <code>
import os
from pydub import AudioSegment
from pydub.silence import split_on_silence

#cutting into the small files
sound_file = AudioSegment.from_wav("filename.wav")
audio_chunks = split_on_silence(sound_file,
    # must be silent for at least a 1500 milliseconds (1.5s)
    min_silence_len=1500,

    # consider it silent if quieter than -40 dBFS
    silence_thresh=-40
    
    # (in ms) amount of silence to leave at the beginning and
    # end of the chunks. Keeps the sound from sounding like it is abruptly cut off.
    keep_silence=150
)

for i, chunk in enumerate(audio_chunks):

    out_file = ".//foldername//chunk{0}.wav".format(i)
    print "exporting", out_file
    chunk.export(out_file, format="wav")
</code>
                </pre>
            </div>
        </div>
        <hr class="hr_half">
        <div class="row">
            <div class="tweleve columns">
                <h5 id="rename_audio">Renaming audio files from .txt</h5>
                Making a list by getting the names from a .txt file that has each name in a line.
                <pre>
                    <code>
import os

os.chdir('path_to_the_folder_of.txt_Names')
with open('names.txt', 'r') as f:
    myNames = [line.strip() for line in f]

#renaming the audio files from the list
os.chdir('path_to_the_folder_of_new_audio_files(line19)')
i=0
for file in os.listdir('the_same_path_as_line_30'):
    if i &lt 439:
        dst=myNames[i]+".wav"
        os.rename('chunk'+str(i)+'.wav',dst)
        i+=1
</code>
                </pre>
            </div>
        </div>
        <hr class="hr_half">
        <div class="row">
            <div class="tweleve columns">
                <h5 id="concatenate">Concatenate two sound files</h5>

                <pre>
                    <code>
import os

from pydub import AudioSegment

sound1 = AudioSegment.from_wav("/path_to/file1.wav")
sound2 = AudioSegment.from_wav("/path/to/file2.wav")

combined_sounds = sound1 + sound2
combined_sounds.export("/output/path.wav", format="wav")
</code>
                </pre>
            </div>
        </div>
    </div>

    <hr>
    <div class="container">
        <h4 id="stata">Stata</h4>
        <div class="intro_stata">
            <ul>
                <li><a href="#dofile" class="intro-item">✎ Do-file</a></li><br>
                <li><a href="#probit_logit" class="intro-item">✎ Probit and Logit</a></li><br>
                <!---       <li><a href="#pca" class="intro-item">Principal Component Analysis</a></li><br>
                        <li><a href="#survival_analysis" class="intro-item">Survival Analysis</a></li><br>
                        <li><a href="#monte_carlo" class="intro-item">Monte Carlo Simulation</a></li> -->
            </ul>
        </div>
        <hr>
        <div class="row">
            <div class="six columns">
                <h5 id="dofile">Do-file</h5>
                <p align="justify">First of all we need to prepare our work space. Almost every do file should start with the following commands (or something very much like them). The first command clears the memory so you don't have to worry about what might have happened before your do file was run. The second closes any open log files. The third limits the mat-size for a higher performance. The fourth tells Stata not to pause whenever the screen fills and wait for you to press a key. <br> <br>A research do file should have a corresponding log file which records all the commands the do file ran and their results. where filename is the name of the file you want Stata to use as a log. Give the log file the same name as the do file it records, so it's obvious which log file goes with which do file. The replace option tells Stata that if a log file with that name already exists, usually from a previous attempt to run the do file, it should be replaced by the current log. <br> <br> Next you will usually load a data set. If the dataset is in the current working directory, you don't need to specify its location. At this point you'll be ready to do your work. Generally this means data preparation, exploratory analysis, or analysis you intend to report or publish. Comments are text included in a do file for the benefit of human readers, not for Stata. <br> <br> Comments can explain what the do file does and why, and if anyone else ever needs to read and understand your do file they'll be very grateful for good comments. But you are the most likely beneficiary of your comments, when you have to figure out how your do file works months or years after writing it.</p>
            </div>
            <div class="six columns">
                <pre>
                    <code>clear all            
capture log close
set matsize 5000            
set more off





log using filename.log, replace








use dataset







* Your comments go after the asterisk
/* Use /**/ for multiple line comments */



</code>
                </pre>
            </div>
        </div>
    </div>
    <hr class="hr_half">

    <div class="container">
        <div class="row">
            <div class="six columns">
                <h5 id="probit_logit">Probit and Logit</h5>
                <p align="justify">
                    The linear probability model has a major flaw: it assumes the conditional probability function to be linear. This does not restrict <span class="math inline">\(P(Y=1\vert X_1,\dots,X_k)\)</span> to lie between <span class="math inline">\(0\)</span> and <span class="math inline">\(1\)</span>. </p>
                <p align="justify">This circumstance calls for an approach that uses a nonlinear function to model the conditional probability function of a binary dependent variable. Commonly used methods are Probit and Logit regression.</p>

                <p align="justify">In Probit regression, the cumulative standard normal distribution function <span class="math inline">\(\Phi(\cdot)\)</span> is used to model the regression function when the dependent variable is binary, that is, we assume
                    <span class="math display" id="eq:probitmodel">\[\begin{align}
                        E(Y\vert X) = P(Y=1\vert X) = \Phi(\beta_0 + \beta_1 X).
                        \end{align}\]</span></p>
                <p>The in the Logit model idea is similar to Probit except that a different CDF is used: <span class="math display">\[F(x) = \frac{1}{1+e^{-x}}\]</span> is the CDF of a standard logistically distributed random variable.</p>

                <p align="justify">In general, you cannot interpret the coefficients from the output of a probit regression (not in any standard way, at least). You need to interpret the <em>marginal effects</em> of the regressors, that is, how much the (conditional) probability of the outcome variable changes when you change the value of a regressor, holding all other regressors constant at some values. This is different from the linear regression case where you are directly interpreting the estimated coefficients. This is so because in the linear regression case, the regression coefficients <em>are the marginal effects</em>. </p>

                <p align="justify">In the probit regression, there is an additional step of computation required to get the marginal effects once you have computed the probit regression fit.</p>

                <p>You can find a good example <a href="https://stats.idre.ucla.edu/stata/dae/probit-regression/" target="_blank">here</a>.</p>


            </div>
            <div class="six columns">
                <pre>
                    <code>
clear all
set more off

use ~path_to_.dta
* or import your data

global xlist x1 x2 x3

describe y $xlist 
summarize y $xlist

tabulate y

* Regression 
reg y $xlist

* Probit model
probit y $xlist

* Logit model
logit y $xlist


/* Marginal effects (at the mean and 
average marginal effect)*/

quietly reg y $xlist
margins, dydx(*) atmeans
margins, dydx(*)

quietly logit y $xlist  
margins, dydx(*) atmeans
margins, dydx(*)

quietly probit y $xlist 
margins, dydx(*) atmeans
margins, dydx(*)


*Logistic model gives odds ratio   
logistic y $xlist 


* Predicted probabilities
quietly logit y $xlist
predict plogit, pr

quietly probit y $xlist 
predict pprobit, pr

quietly regress y $xlist
predict pols, xb

summarize y plogit pprobit pols


* Percent correctly predicted values
quietly logit y $xlist
estat classification

quietly probit $ylist $xlist
estat classification

</code>
                </pre>
            </div>
        </div>
    </div>
    <div class="footer">
        <div class="row">
            <div class="four columns">
                <h6 class="footer_h6">Contact</h6>
                <p class="footer_h6">
                    &#x02609 parham.ashur[at]etu-univ1[dot]fr
                    <br>
                    &#x02609 29 rue d'Ulm, Paris</p>
            </div>
            <div class="three columns">
                <h6 class="footer_h6">Code</h6>
                <p class="footer_h6">
                    <a href="code/code.html#r" id="linkcolor_footer">&#10070 R</a><br>
                    <!--  <a href="code/code.html#c" id="linkcolor_footer">&#10070 C for Arduino</a><br> -->
                    <a href="code/code.html#shell" id="linkcolor_footer"> &#10070 Shell Script</a><br>
                    <a href="code/code.html#python" id="linkcolor_footer">&#10070 Python</a><br>
                    <a href="code/code.html#stata" id="linkcolor_footer">&#10070 Stata</a><br></p>
            </div>
            <div class="three columns">
                <h6 class="footer_h6">Resources</h6>
                <p class="footer_h6">
                    <a href="https://learnpythonthehardway.org/book/" target="_blank" id="linkcolor_footer">&#10070 Learn Python</a><br>
                    <a href="https://www.latex-tutorial.com" target="_blank" id="linkcolor_footer">&#10070 Learn Latex</a><br>
                    <a href="https://swirlstats.com" target="_blank" id="linkcolor_footer">&#10070 Learn R</a><br>
                </p>
            </div>
            <div class="two columns">
                <h6 class="footer_h6">Links</h6>
                <p class="footer_h6">
                    <a href="https://www.upwork.com/o/profiles/users/_~016515787f8dbe61ea/" target="_blank" id="linkcolor_footer">&#10070 Upwork</a><br>

                    <a href="https://github.com/parhamashur" target="_blank" id="linkcolor_footer">&#10070 Github</a><br>
                    <!--        <a href="https://www.latex-tutorial.com" target="_blank" id="linkcolor_footer">&#10070 Learn Latex</a><br>
                    <a href="https://swirlstats.com" target="_blank" id="linkcolor_footer">&#10070 Learn R</a><br> -->
                </p>
            </div>
        </div>
    </div>

</body></html>
